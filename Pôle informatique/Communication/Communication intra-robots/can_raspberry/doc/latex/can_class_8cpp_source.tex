\hypertarget{can_class_8cpp_source}{}\doxysection{can\+Class.\+cpp}
\mbox{\hyperlink{can_class_8cpp}{Aller à la documentation de ce fichier.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00001}00001 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00009}00009 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00010}00010 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00011}00011 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00012}00012 \textcolor{preprocessor}{\#include <unistd.h>}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00013}00013 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00014}00014 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00015}00015 \textcolor{preprocessor}{\#include <net/if.h>}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00016}00016 \textcolor{preprocessor}{\#include <sys/ioctl.h>}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00017}00017 \textcolor{preprocessor}{\#include <sys/socket.h>}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00018}00018 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00019}00019 \textcolor{preprocessor}{\#include <linux/can.h>}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00020}00020 \textcolor{preprocessor}{\#include <linux/can/raw.h>}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00021}00021 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00022}00022 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00023}00023 \textcolor{preprocessor}{\#include <unistd.h>}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00024}00024 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00025}00025 \textcolor{preprocessor}{\#include <thread>}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00026}00026 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00028}00028 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00029}00029 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{can_class_8h}{canClass.h}}"{}}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00030}00030 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{define_can_8h}{defineCan.h}}"{}}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00031}00031 \textcolor{keyword}{using namespace }std;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00032}00032 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00033}\mbox{\hyperlink{class_can_a99db0c143e5c870ae419a138a81f23e9}{00033}} \mbox{\hyperlink{class_can_a99db0c143e5c870ae419a138a81f23e9}{Can::Can}}()\{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00034}00034     }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00035}00035     \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00036}00036 \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00037}00037 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00038}00038 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00048}\mbox{\hyperlink{class_can_a269e2c1f9af10b970b55277fefd26a2f}{00048}} \textcolor{keywordtype}{int} \mbox{\hyperlink{class_can_a269e2c1f9af10b970b55277fefd26a2f}{Can::init}}(uint myAddr)\{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00049}00049     \textcolor{keywordtype}{int} i; }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00050}00050     \textcolor{keywordtype}{int} nbytes;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00051}00051     \textcolor{keyword}{struct }sockaddr\_can addr;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00052}00052     \textcolor{keyword}{struct }ifreq ifr;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00053}00053 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00054}00054 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00055}00055     \textcolor{keywordflow}{if} ((s = socket(PF\_CAN, SOCK\_RAW, CAN\_RAW)) < 0) \{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00056}00056         perror(\textcolor{stringliteral}{"{}Socket"{}});}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00057}00057         \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_a2f40a35c036524aa48b7974aa1d6355e}{CAN\_E\_SOCKET\_ERROR}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00058}00058     \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00059}00059     strcpy(ifr.ifr\_name, \mbox{\hyperlink{define_can_8h_a1ca268213eaac8915f331671226d45c5}{CAN\_BUS\_NAME}}); \textcolor{comment}{//definie le bus sur le quel on travaille (can0 ou vcan0 normalement)}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00060}00060     ioctl(s, SIOCGIFINDEX, \&ifr);}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00061}00061 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00062}00062     memset(\&addr, 0, \textcolor{keyword}{sizeof}(addr));}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00063}00063     addr.can\_family = AF\_CAN;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00064}00064     addr.can\_ifindex = ifr.ifr\_ifindex;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00065}00065 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00066}00066     \textcolor{keywordflow}{if} (bind(s, (\textcolor{keyword}{struct} sockaddr *)\&addr, \textcolor{keyword}{sizeof}(addr)) < 0) \{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00067}00067         perror(\textcolor{stringliteral}{"{}Bind"{}});}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00068}00068         \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_a914ffcfbdce06d1a257c31b5bf6a8ceb}{CAN\_E\_BIND\_ERROR}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00069}00069     \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00070}00070 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00071}00071     \textcolor{comment}{// si l'address est incorect on ne setup juste pas de filtre}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00072}00072     \textcolor{keywordflow}{if}(myAddr <0 || myAddr > \mbox{\hyperlink{define_can_8h_a75fed7f96ed96ce2e78b1e28d2379d50}{CAN\_MAX\_VALUE\_ADDR}}) \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_a799d865841a6891a9a2af75eb6ff808b}{CAN\_E\_OOB\_ADDR}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00073}00073     \textcolor{keywordflow}{if}(!\mbox{\hyperlink{class_can_a84329bf906b93154c074cd30a13d58c9}{is\_valid\_addr}}(myAddr)) \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_aa83f631cf1307d1d3ad54d745a1c1956}{CAN\_E\_UNKNOW\_ADDR}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00074}00074     }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00075}00075     \textcolor{comment}{//  Initialisation de l'adresse}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00076}00076     \textcolor{keyword}{struct }can\_filter rfilter[1];}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00077}00077     rfilter[0].can\_id   = myAddr << \mbox{\hyperlink{define_can_8h_ab1b32cb6659550f6c42cdf2b593d7fad}{CAN\_DECALAGE\_ADDR\_RECEPTEUR}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00078}00078     rfilter[0].can\_mask = \mbox{\hyperlink{define_can_8h_a1d500ac425f24d6e3ed119355574fade}{CAN\_FILTER\_ADDR\_RECEPTEUR}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00079}00079 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00080}00080 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00081}00081     setsockopt(s, SOL\_CAN\_RAW, CAN\_RAW\_FILTER, \&rfilter, \textcolor{keyword}{sizeof}(rfilter));}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00082}00082 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00083}00083     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00084}00084 \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00085}00085 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00092}\mbox{\hyperlink{class_can_a84329bf906b93154c074cd30a13d58c9}{00092}} \textcolor{keywordtype}{bool} \mbox{\hyperlink{class_can_a84329bf906b93154c074cd30a13d58c9}{Can::is\_valid\_addr}}(uint addr)\{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00093}00093     \textcolor{keywordtype}{int} size = \textcolor{keyword}{sizeof}(\mbox{\hyperlink{define_can_8h_a74ef7874b1f8d3f59c3512e71bff5dc0}{CAN\_LIST\_ADDR}})/\textcolor{keyword}{sizeof}(\mbox{\hyperlink{define_can_8h_a74ef7874b1f8d3f59c3512e71bff5dc0}{CAN\_LIST\_ADDR}}[0]);}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00094}00094     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < size; i++)}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00095}00095     \{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00096}00096         \textcolor{keywordflow}{if}(addr == \mbox{\hyperlink{define_can_8h_a74ef7874b1f8d3f59c3512e71bff5dc0}{CAN\_LIST\_ADDR}}[i]) \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00097}00097     \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00098}00098     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00099}00099 \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00100}00100 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00107}\mbox{\hyperlink{class_can_a218864c4615d1324178520b155752c3c}{00107}} \textcolor{keywordtype}{bool} \mbox{\hyperlink{class_can_a218864c4615d1324178520b155752c3c}{Can::is\_valid\_code\_fct}}(uint codeFct)\{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00108}00108     \textcolor{keywordtype}{int} size = \textcolor{keyword}{sizeof}(\mbox{\hyperlink{define_can_8h_a298bad7c46f3cbca96c1de0600c29b2b}{CAN\_LIST\_CODE\_FCT}})/\textcolor{keyword}{sizeof}(\mbox{\hyperlink{define_can_8h_a298bad7c46f3cbca96c1de0600c29b2b}{CAN\_LIST\_CODE\_FCT}}[0]);}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00109}00109     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < size; i++)}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00110}00110     \{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00111}00111         \textcolor{keywordflow}{if}(codeFct == \mbox{\hyperlink{define_can_8h_a298bad7c46f3cbca96c1de0600c29b2b}{CAN\_LIST\_CODE\_FCT}}[i]) \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00112}00112     \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00113}00113     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00114}00114 \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00115}00115 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00134}\mbox{\hyperlink{class_can_aa005c63a0c208e7a4863eb176ada1c4b}{00134}} \textcolor{keywordtype}{int} \mbox{\hyperlink{class_can_aa005c63a0c208e7a4863eb176ada1c4b}{Can::send}}(uint addr, uint codeFct , uint8\_t data[], uint data\_len, \textcolor{keywordtype}{bool} isRep, uint repLenght)\{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00135}00135     \textcolor{keywordflow}{if} (data\_len >8)\{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00136}00136         cout << \textcolor{stringliteral}{"{}vous ne pouvez envoyer que 8 octet de data"{}} << endl;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00137}00137         \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_a7c9d901a9117c30a9e98a1c0bc66486e}{CAN\_E\_DATA\_SIZE\_TOO\_LONG}};   }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00138}00138     \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00139}00139 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00140}00140     \textcolor{keywordflow}{if}(addr < 0 || addr > \mbox{\hyperlink{define_can_8h_a75fed7f96ed96ce2e78b1e28d2379d50}{CAN\_MAX\_VALUE\_ADDR}}) \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_a799d865841a6891a9a2af75eb6ff808b}{CAN\_E\_OOB\_ADDR}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00141}00141     \textcolor{keywordflow}{if}(codeFct < 0 || codeFct > \mbox{\hyperlink{define_can_8h_a51b701307838aca40e345c41def70645}{CAN\_MAX\_VALUE\_CODE\_FCT}}) \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_aebd7c7695cbdd519ede6b67656f0e14d}{CAN\_E\_OOB\_CODE\_FCT}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00142}00142     \textcolor{keywordflow}{if}(repLenght < 0 || repLenght > \mbox{\hyperlink{define_can_8h_a42f38238435715e3b6f5be8e1fce9c6e}{CAN\_MAX\_VALUE\_REP\_NBR}}) \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_aeef6a6625674efad1e7f56918dd54bfb}{CAN\_E\_OOB\_REP\_NBR}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00143}00143 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00144}00144     \textcolor{keywordflow}{if}(!\mbox{\hyperlink{class_can_a84329bf906b93154c074cd30a13d58c9}{is\_valid\_addr}}(addr)) \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_aa83f631cf1307d1d3ad54d745a1c1956}{CAN\_E\_UNKNOW\_ADDR}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00145}00145     \textcolor{keywordflow}{if}(!\mbox{\hyperlink{class_can_a218864c4615d1324178520b155752c3c}{is\_valid\_code\_fct}}(codeFct)) \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_a4c440f9ee9eb993e766253a9d65eb35e}{CAN\_E\_UNKNOW\_CODE\_FCT}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00146}00146 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00147}00147 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00148}00148 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00149}00149 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00150}00150     \textcolor{keyword}{struct }can\_frame frame;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00151}00151     frame.can\_id = (}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00152}00152           (addr << \mbox{\hyperlink{define_can_8h_ab1b32cb6659550f6c42cdf2b593d7fad}{CAN\_DECALAGE\_ADDR\_RECEPTEUR}}) }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00153}00153         + (\mbox{\hyperlink{define_can_8h_a78913f34808bd64cf9bd21cf15d30ecf}{CAN\_ADDR\_RASPBERRY}} << \mbox{\hyperlink{define_can_8h_a983f2481738cf366df61eb3d0c87390c}{CAN\_DECALAGE\_ADDR\_EMETTEUR}}) }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00154}00154         + (codeFct << \mbox{\hyperlink{define_can_8h_a9180457c5e593c03c7e47fdae02da987}{CAN\_DECALAGE\_CODE\_FCT}}) }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00155}00155         + (isRep << \mbox{\hyperlink{define_can_8h_aa1d266e09c16cf127535b9f25628171d}{CAN\_DECALAGE\_IS\_REP}}) }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00156}00156         + (repLenght << \mbox{\hyperlink{define_can_8h_a0404b9b0ecae85c52df9ccc83f3dc91a}{CAN\_DECALAGE\_REP\_NBR}})}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00157}00157         )| CAN\_EFF\_FLAG;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00158}00158 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00159}00159     cout << hex << frame.can\_id << endl;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00160}00160     frame.can\_dlc = data\_len;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00161}00161 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00162}00162     printf(\textcolor{stringliteral}{"{}send : 0x\%03X [\%d] "{}},frame.can\_id, frame.can\_dlc);}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00163}00163     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < data\_len; i++)}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00164}00164     \{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00165}00165         \textcolor{keywordflow}{if}(data[i] <0 || data[i] > 255) \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_abc58456a755106030627e580180a128f}{CAN\_E\_OOB\_DATA}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00166}00166         frame.data[i] = data[i];}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00167}00167         printf(\textcolor{stringliteral}{"{}\%02X "{}},frame.data[i]);}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00168}00168     \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00169}00169     printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}}); }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00170}00170 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00171}00171     \textcolor{keywordflow}{if} (write(s, \&frame, \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} can\_frame)) != \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} can\_frame)) \{ \textcolor{comment}{//on verifie que le nombre de byte envoyer est corecte}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00172}00172         perror(\textcolor{stringliteral}{"{}Write"{}});}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00173}00173         \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_a6bf56f5be9d3aa20861b906369729edd}{CAN\_E\_WRITE\_ERROR}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00174}00174     \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00175}00175 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00176}00176     \textcolor{keywordflow}{return} 0;   }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00177}00177 \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00178}00178 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00192}00192 \textcolor{keywordtype}{int} Can::traitement\_trame(\mbox{\hyperlink{struct_can_response__t}{CanResponse\_t}} \&rep, can\_frame frame)\{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00193}00193 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00194}00194     \textcolor{keywordtype}{int} nbytes;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00195}00195         nbytes = read(s, \&frame, \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} can\_frame));}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00196}00196         \textcolor{keywordflow}{if} (nbytes < 0) \{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00197}00197             perror(\textcolor{stringliteral}{"{}Read"{}});}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00198}00198             \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_a0c2d2a8e91c88952d1dd0f97a7cf6f5a}{CAN\_E\_READ\_ERROR}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00199}00199         \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00200}00200 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00201}00201         rep.\mbox{\hyperlink{struct_can_response__t_a453ff84b77410a4ae3624d05cea8f3dd}{addr}} = (frame.can\_id \& \mbox{\hyperlink{define_can_8h_a1d500ac425f24d6e3ed119355574fade}{CAN\_FILTER\_ADDR\_RECEPTEUR}} ) >> \mbox{\hyperlink{define_can_8h_ab1b32cb6659550f6c42cdf2b593d7fad}{CAN\_DECALAGE\_ADDR\_RECEPTEUR}} ;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00202}00202         rep.\mbox{\hyperlink{struct_can_response__t_aa9f95aad100040074ffba8c502680e7e}{emetteur}} = (frame.can\_id \& \mbox{\hyperlink{define_can_8h_a2b788e5e1432b2ab177624d70adb53f0}{CAN\_FILTER\_ADDR\_EMETTEUR}}) >> \mbox{\hyperlink{define_can_8h_a983f2481738cf366df61eb3d0c87390c}{CAN\_DECALAGE\_ADDR\_EMETTEUR}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00203}00203         rep.\mbox{\hyperlink{struct_can_response__t_a6934a75268c9d93b17e35c715a8fb464}{codeFct}} = (frame.can\_id \& \mbox{\hyperlink{define_can_8h_afb52b232cc457e9f6388ca2c44a635bf}{CAN\_FILTER\_CODE\_FCT}}) >> \mbox{\hyperlink{define_can_8h_a9180457c5e593c03c7e47fdae02da987}{CAN\_DECALAGE\_CODE\_FCT}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00204}00204         rep.\mbox{\hyperlink{struct_can_response__t_aa51075910c54851cc8daf19ec6367469}{isRep}} = (frame.can\_id \& \mbox{\hyperlink{define_can_8h_a2b3f1fb3ae9ba22712eb76ecbfe547db}{CAN\_FILTER\_IS\_REP}}) >> \mbox{\hyperlink{define_can_8h_aa1d266e09c16cf127535b9f25628171d}{CAN\_DECALAGE\_IS\_REP}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00205}00205         rep.\mbox{\hyperlink{struct_can_response__t_aa6158dd306c9806f5f86c6ac9bca9f96}{RepId}} = (frame.can\_id \& \mbox{\hyperlink{define_can_8h_acb7416a9dbb951d360e48b12d52a6982}{CAN\_FILTER\_REP\_NBR}}) >> \mbox{\hyperlink{define_can_8h_a0404b9b0ecae85c52df9ccc83f3dc91a}{CAN\_DECALAGE\_REP\_NBR}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00206}00206 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00207}00207 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00208}00208         \textcolor{keywordflow}{if}(rep.\mbox{\hyperlink{struct_can_response__t_a453ff84b77410a4ae3624d05cea8f3dd}{addr}} <0 || rep.\mbox{\hyperlink{struct_can_response__t_a453ff84b77410a4ae3624d05cea8f3dd}{addr}} > \mbox{\hyperlink{define_can_8h_a75fed7f96ed96ce2e78b1e28d2379d50}{CAN\_MAX\_VALUE\_ADDR}}) \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_a799d865841a6891a9a2af75eb6ff808b}{CAN\_E\_OOB\_ADDR}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00209}00209         \textcolor{keywordflow}{if}(rep.\mbox{\hyperlink{struct_can_response__t_a6934a75268c9d93b17e35c715a8fb464}{codeFct}} <0 || rep.\mbox{\hyperlink{struct_can_response__t_a6934a75268c9d93b17e35c715a8fb464}{codeFct}} > \mbox{\hyperlink{define_can_8h_a51b701307838aca40e345c41def70645}{CAN\_MAX\_VALUE\_CODE\_FCT}}) \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_aebd7c7695cbdd519ede6b67656f0e14d}{CAN\_E\_OOB\_CODE\_FCT}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00210}00210         \textcolor{keywordflow}{if}(rep.\mbox{\hyperlink{struct_can_response__t_aa6158dd306c9806f5f86c6ac9bca9f96}{RepId}} <0 || rep.\mbox{\hyperlink{struct_can_response__t_aa6158dd306c9806f5f86c6ac9bca9f96}{RepId}} > \mbox{\hyperlink{define_can_8h_a42f38238435715e3b6f5be8e1fce9c6e}{CAN\_MAX\_VALUE\_REP\_NBR}}) \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_aeef6a6625674efad1e7f56918dd54bfb}{CAN\_E\_OOB\_REP\_NBR}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00211}00211 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00212}00212         \textcolor{keywordflow}{if}(!\mbox{\hyperlink{class_can_a84329bf906b93154c074cd30a13d58c9}{is\_valid\_addr}}(rep.\mbox{\hyperlink{struct_can_response__t_a453ff84b77410a4ae3624d05cea8f3dd}{addr}})) \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_aa83f631cf1307d1d3ad54d745a1c1956}{CAN\_E\_UNKNOW\_ADDR}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00213}00213         \textcolor{keywordflow}{if}(!\mbox{\hyperlink{class_can_a84329bf906b93154c074cd30a13d58c9}{is\_valid\_addr}}(rep.\mbox{\hyperlink{struct_can_response__t_aa9f95aad100040074ffba8c502680e7e}{emetteur}})) \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_aa83f631cf1307d1d3ad54d745a1c1956}{CAN\_E\_UNKNOW\_ADDR}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00214}00214         \textcolor{keywordflow}{if}(!\mbox{\hyperlink{class_can_a218864c4615d1324178520b155752c3c}{is\_valid\_code\_fct}}(rep.\mbox{\hyperlink{struct_can_response__t_a6934a75268c9d93b17e35c715a8fb464}{codeFct}})) \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_a4c440f9ee9eb993e766253a9d65eb35e}{CAN\_E\_UNKNOW\_CODE\_FCT}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00215}00215         \textcolor{keywordflow}{if} (frame.can\_dlc >8)  \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_a7c9d901a9117c30a9e98a1c0bc66486e}{CAN\_E\_DATA\_SIZE\_TOO\_LONG}};   }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00216}00216         rep.\mbox{\hyperlink{struct_can_response__t_a744927d9f0dcb9cfd21dabdf6a221259}{dataLen}} = frame.can\_dlc;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00217}00217         }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00218}00218 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00219}00219         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < frame.can\_dlc; i++)\{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00220}00220             \textcolor{keywordflow}{if}(frame.data[i] <0 || frame.data[i] > 255) \textcolor{keywordflow}{return} \mbox{\hyperlink{define_can_8h_abc58456a755106030627e580180a128f}{CAN\_E\_OOB\_DATA}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00221}00221             rep.\mbox{\hyperlink{struct_can_response__t_ac167ce09dbe42c5a5497bd7331f8f22d}{data}}[i] = frame.data[i];}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00222}00222         \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00223}00223 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00224}00224 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00225}00225     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00226}00226 \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00227}00227 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00232}00232 \textcolor{keywordtype}{void} Can::listen()\{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00233}00233     \textcolor{keywordflow}{while}(\textcolor{keyword}{true})\{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00234}00234         \textcolor{keyword}{struct }can\_frame frame;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00235}00235         \textcolor{keyword}{struct }\mbox{\hyperlink{struct_can_response__t}{CanResponse\_t}} reponse;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00236}00236         }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00237}00237         \textcolor{keywordtype}{int} err =traitement\_trame(reponse, frame);}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00238}00238         \textcolor{keywordflow}{if}(err < 0)\{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00239}00239             cout << \textcolor{stringliteral}{"{}erreur dans le décodage d'une trame. err n°"{}} << dec << err << \textcolor{stringliteral}{"{}\(\backslash\)t\(\backslash\)t c.f. \#define"{}} << endl;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00240}00240             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00241}00241         \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00242}00242 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00243}00243 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00244}00244         cout << \textcolor{stringliteral}{"{}addr : "{}} << hex << reponse.addr ;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00245}00245         cout << \textcolor{stringliteral}{"{}   emetteur : "{}} << hex << reponse.emetteur;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00246}00246         cout << \textcolor{stringliteral}{"{}   codeFct : "{}} << hex << reponse.codeFct;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00247}00247         cout << \textcolor{stringliteral}{"{}   isRep : "{}} << reponse.isRep;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00248}00248         cout << \textcolor{stringliteral}{"{}   RepId : "{}} << hex << reponse.RepId;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00249}00249         cout << \textcolor{stringliteral}{"{}       Data : ["{}}<< (int)reponse.dataLen <<\textcolor{stringliteral}{"{}] "{}};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00250}00250         for (\textcolor{keywordtype}{int} i = 0; i < frame.can\_dlc; i++) printf(\textcolor{stringliteral}{"{}\%02X "{}},reponse.data[i]);}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00251}00251         printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00252}00252 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00253}00253         thread test(\&\mbox{\hyperlink{class_can_ae2cd8392b0a4dc6f5dd91c558ef492a8}{Can::traitement}},\textcolor{keyword}{this}, reponse);}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00254}00254         test.detach();}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00255}00255         }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00256}00256     \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00257}00257 \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00258}00258 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00263}\mbox{\hyperlink{class_can_ae2cd8392b0a4dc6f5dd91c558ef492a8}{00263}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_can_ae2cd8392b0a4dc6f5dd91c558ef492a8}{Can::traitement}}(\mbox{\hyperlink{struct_can_response__t}{CanResponse\_t}} msg)\{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00264}00264     \textcolor{keywordflow}{switch} (msg.\mbox{\hyperlink{struct_can_response__t_aa9f95aad100040074ffba8c502680e7e}{emetteur}})\{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00265}00265     \textcolor{keywordflow}{case} \mbox{\hyperlink{define_can_8h_a5b316309912dfb2e41e42f1c93fc4d37}{CAN\_ADDR\_BASE\_ROULANTE}}:}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00266}00266         \textcolor{keywordflow}{switch} (msg.\mbox{\hyperlink{struct_can_response__t_a6934a75268c9d93b17e35c715a8fb464}{codeFct}})\{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00267}00267         \textcolor{keywordflow}{case} \mbox{\hyperlink{define_can_8h_a7afe629b79f044b909a1122578976339}{AVANCE}}:}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00268}00268 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00269}00269 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00270}00270         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00271}00271         \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00272}00272             cout << \textcolor{stringliteral}{"{}code fonction inconu"{}} << endl;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00273}00273         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00274}00274         \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00275}00275 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00276}00276 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00277}00277     \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00278}00278     \textcolor{keywordflow}{case} \mbox{\hyperlink{define_can_8h_a78913f34808bd64cf9bd21cf15d30ecf}{CAN\_ADDR\_RASPBERRY}}:}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00279}00279         cout << \textcolor{stringliteral}{"{}self emeteur"{}} << endl;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00280}00280     \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00281}00281     \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00282}00282         cout << \textcolor{stringliteral}{"{}emetteur inconu"{}} << endl;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00283}00283     \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00284}00284     \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00285}00285 \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00286}00286 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00291}\mbox{\hyperlink{class_can_a7f61af281f70ed5b377f15c803f1f63a}{00291}} \textcolor{keywordtype}{int} \mbox{\hyperlink{class_can_a7f61af281f70ed5b377f15c803f1f63a}{Can::start\_listen}}()\{}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00292}00292     thread tListen(\&Can::listen, \textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00293}00293     tListen.detach();}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00294}00294     threadListen = \&tListen;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00295}00295     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00296}00296 \}}
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00297}00297 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00298}00298 }
\DoxyCodeLine{\Hypertarget{can_class_8cpp_source_l00299}00299 }

\end{DoxyCode}
